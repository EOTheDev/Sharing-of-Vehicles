<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- grafico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js" integrity="sha256-yz7K02nILYEeRDwEfzu/1zI9SpBKod/nLYMTFh7vszs=" crossorigin="anonymous"></script>
    <!-- JQUERY NECESSARIO PER NAV -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <!-- bootstrap e popper-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- css pagina -->
    <link rel="stylesheet" href="/css/home.css">
    <title>Homepage di Greenshare</title>
    
</head>
<body>
    <!-- carico header con thymeleaf -->
    <header class="header" th:replace="html/nav" id="navbarContainer">
    </header>
    <main>
        <!-- carosello bootstrap -->
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active" style="position: relative;">
                    <img class="d-block w-100" src="/imgs/carosello0.jpg" alt="First slide">
                    <div class="carousel-caption" style="position: absolute; height: 100%; left: 2rem; top:0rem; max-width:20vw; color:var(--dark); display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <img src="/imgs/logo_large.png" style="max-width: 150px; width: 10vw; padding-bottom: 1rem;" alt="">
                        <h2 style="font-size: 2vw; padding-bottom: 1rem;">PERCHÉ GUIDARE UN'AUTO ELETTRICA?</h2>
                        <p style="font-size: 1vw;">Vantaggi tecnologici, ecologici, sociali, economici, più il brivido di un'accelerazione fluida e istantanea. E non solo.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/imgs/carosello1.jpg" alt="Second slide">
                    <div class="carousel-caption" >
                        <h2 style="font-size: 3vw;padding-bottom: 0.3rem;">AVVENTURA SENZA LIMITI</h2>
                        <p style="font-size: 1.5vw;">Per chi desidera spingere l'elettrico in territori inesplorati, la RGNT Scrambler è senz'altro l'invincibile paladino. Non si tratta solo di una moto elettrica sempre pronta per l'avventura ma è anche la più capace del pianeta. Esplorate nuove strade in sella alla moto ma senza tutto il frastuono.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/imgs/carosello2.jpg" alt="Third slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/imgs/carosello3.jpg" alt="Forth slide">
                    
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        <nav>
            <div class="nav nav-tabs" th:switch="${utente}" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Prenota</a>
                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Info</a>
                <a class="nav-item nav-link " th:case="null" href="/login">Login</a>
                <a class="nav-item nav-link" th:case="*" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Il Mio Profilo</a>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                <!-- tab home -->
                <!-- inizio grafico -->
                <!-- prenota veicolo -->
                <div class="row">
                    <!-- calendario -->
                    <div class="col-lg-4 latoCalendario">
                        <div id="calendar" >
                            
                            <div id="topCalendar">
                                <input type="date" onblur="aggiornoDisponibilita()" id="dataPrenotazione">
                            </div>
                            <div id="dateCalendar">
                                <!-- <button class="btn btn-primary"><i class="fas fa-arrow-left"></i></button> -->
                                <span id="giorno">
                                    10
                                </span>
                                
                                <!-- <button class="btn btn-primary"><i class="fas fa-arrow-right"></i></button> -->
                            </div>
                            <span id="mese">Settembre</span><br>
                            <span id="anno">2021</span>
                        </div>
                        <i class="fas fa-leaf" style="font-size: 4rem; color:#9dc119;padding: 1rem 0;"></i>
                        <a th:switch="${utente}" style="padding: 1rem 0;">
                            <button th:case="null" class="btn btn-primary" id="loginBtn">Fai il login per noleggiare!</button>
                            <button th:case="*" class="btn btn-primary" id="loginBtn">Grazie, [[${utente.nome}]], per inquinare meno!</button>
                        </a>
                    </div>
                    <!-- fine calendario -->
                    <!-- inizio veicoli -->
                    <div class="col-lg-8 elencoVeicoli">
                        <h1>I veicoli disponibili</h1>
                        <!-- singolo veicolo -->
                        <div id="veicoliDisponibili" th:each="veicolo:${veicoli}">
                            <div class="row singoloVeicolo">
                                <div th:switch="${utente}"class="col-lg-2 side">
                                    <img class="col-lg-12" src="https://www.you-go.it/wp-content/uploads/2020/11/volkswagen-id3-bianca-647x277.png" th:attr="src=@{'/imgUpl/'+${veicolo.id}+'/'+${veicolo.immagine}}"alt="" >
                                    <a th:case="null" class="col-lg-12 linkVeicolo" href="/veicolo" th:href="@{'/veicolo/'+${veicolo.id}}"><button class="col-12 btn edit">Iscriviti</button></a> 
                                    <a th:case="*" class="col-lg-12 linkVeicolo" href="/veicolo" th:href="@{'/veicolo/'+${veicolo.id}+'/'+${utente.id}}"><button class="col-12 btn edit">Prenota</button></a> 
                                    
                                </div>
                                <div class="col-lg-10 rightSide">
                                    <h2 th:switch="${veicolo.alimentazione}" class="titolo">
                                        <span class="modello" th:text="${veicolo.modello}">BMW I8</span>
                                        <i th:case="'Diesel'" class="fas fa-smog text-muted">
                                            <span class="text-muted alimentazione" th:text="${veicolo.alimentazione}"> 
                                                Ibrida
                                            </span> <!-- se implemento thymeleaf sovrascrive icona -->
                                        </i>
                                        <i th:case="'benzina'" class="fas fa-smog text-muted">
                                            <span class="text-muted alimentazione" th:text="${veicolo.alimentazione}"> 
                                                Ibrida
                                            </span> <!-- se implemento thymeleaf sovrascrive icona -->
                                        </i>
                                        <i th:case="*" class="fas fa-bolt text-muted">
                                            <span class="text-muted alimentazione" th:text="${veicolo.alimentazione}"> 
                                                Ibrida
                                            </span> <!-- se implemento thymeleaf sovrascrive icona -->
                                        </i>
                                    </h2>
                                    <div th:switch="${veicolo.tipologia}" class="text">
                                        <!-- if auto fa-car-alt, else if fa-leaf -->                              
                                        <i th:case="'auto'" class="fas fa-car-alt">
                                            <span class="tipo" th:text="${veicolo.tipologia}"> Auto</span>
                                        </i>
                                        <i th:case="*" class="fas fa-leaf ">
                                            <span class="tipo" th:text="${veicolo.tipologia}"> Auto</span>
                                        </i>
                                        
                                        <i class="fas fa-map-marker-alt">
                                            <span class="posizione" th:text="${veicolo.indirizzo}"> Via del Campo, Torino </span>
                                        </i>
                                        <div class="descrizione" th:text="${veicolo.descrizione}">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum iusto excepturi deserunt, error optio laboriosam expedita laudantium repellat. Impedit, laboriosam aliquid quibusdam deleniti dolores eaque ratione tenetur harum porro quis!*5</div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        <!-- fine singolo veicolo -->
                        
                    </div>
                </div>
                <!-- fine banner veicoli -->
                
            </div>
                <!-- fine tab home -->
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                    
                <div class="container">
                    <!-- grafico 1 -->
                    <div class="row graphicMaster">
                        <div class="col-lg-6 sinistraGrafico">
                            <h2 id="titoloGrafico">
                                Emissioni risparmiate
                            </h2>
                            <h4 class="text-muted" id="sottotitoloGrafico">
                                Calcolo delle emissioni risparmiate per ogni nostro tipo di veicolo 
                            </h4>
                            <p>
                                Per il rispetto dell'ambiente e per la lotta al cambiamento climatico è bene avere in mente delle informazioni chiare sull'impatto ambientale delle nostre scelte.
                                <br>E' noto che:
                                <ul> 
                                <li>Un'auto diesel produce 2380g di Co2 per ogni litro consumato.</li>
                                <li>Un'auto ibrida produce 60g di Co2 per ogni km percorso.</li>
                                <li>Un'auto benzina produce 1610g di Co2 per ogni litro di benzina consumato.</li>
                                <li>Un'auto elettrica non produce Co2 per consumo diretto ma soltanto nella sua creazione.</li>
                                </ul>
                                Come mostrato nel grafico, possiamo notare le emissioni risparmiate con l'utilizzo di un veicolo ibrido o elttrico.</p>
                            
                        </div>
                        
                        <div class="col-lg-4">
                            <canvas id="graficoEmissioni"  width="400" height="400"></canvas>
                        </div>
                        <div class="col"></div>
                        
                    </div>
                    <!-- fine grafico 1 -->
                    <div class="row graphicMaster">
                        <div class="col"></div>
                        <div class="col-lg-4">
                            <canvas id="graficoVeicoli"  width="400" height="400"></canvas>
                            
                        </div>
                        <div class="col-lg-6 sinistraGrafico">
                            <h2 id="titoloGrafico">
                                I nostri veicoli
                            </h2>
                            <h4 class="text-muted" id="sottotitoloGrafico">
                                Grafico che compara i nostri veicoli per prezzo, emissioni risparmiate, tipologia ed alimentazione
                            </h4>
                            <p>
                                <p>Come si può notare nel grafico, la scelta green è sempre la migliore soluzione, verso la quale cerchiamo di indirizzare i nostri clienti, consigliando un'alimentazione ecosostenibile.</p>
                                <p>Comparando le nostre tipologie di veicoli, anche per fascia di prezzo, possiamo vedere che oltre a veicoli con poche emissioni ma a prezzi elevati, disponiamo inoltre di prodotti più economici, ma allo stesso tempo eco-friendly, come ad esempio la bicicletta "Kinky Segway 500", o le stampelle "Power 2000".</p>
                            </p>
                            
                        </div>
                    </div>
                </div>
                </div>
                
                
                    <div class="tab-pane fade" th:switch="${utente}" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                        <h1 th:case="null">Non dovresti essere qui</h1>
                        <div th:case="*">
                            <div class="container" th:switch="${prenotazioni}">
                                <div class="row">
                                    <h1>I tuoi dati personali</h1>
                                </div>
                                <div th:object="${utente}" class="row">
                                    <div class="col">
                                        <h4>Username: <span id="username" th:text="*{username}"></span></h4>
                                        <h4>Nome: <span id="nome" th:text="*{nome}"></span></h4>
                                        <h4>Cognome: <span id="cognome" th:text="*{cognome}"></span></h4>
                                        <h4>Data di Nascita: <span id="dataNascita" th:text="*{nascita}"></span></h3>
                                    </div>
                                    <div class="col">
                                        <h4>Data di Iscrizione: <span th:text="*{dataIscrizione}"></span></h4>
                                        <h4>Email: <span id="email" th:text="*{email}"></span></h4>
                                        <button class="btn edit editCliente" id="btnMod">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- chiudo utente -->
                                <hr>
                                <!--TAB PRENOTAZIONI  -->
                                <div class="row">
                                    <h1>Le tue prenotazioni</h1>
                                </div>
                                <div class="row" th:case="null">
                                    <div class="col">
                                        <i class="fas fa-heart-broken" style="text-align: center; font-size: 5rem;"></i>
                                        <h3>Non hai ancora prenotazioni.</h3>
                                    </div>
                                </div>
                                <div th:case="*">
                                    <div class="row"  >
                                        <div class="col-md-4 singolaPrenotazione" th:each="pren: ${prenotazioni}" style="padding-bottom: 1rem;"> 
                                            <h4>Numero prenotazione: <span style="font-weight: 600;" th:text="${pren.id}"></span></h4>
                                            <h4>Veicolo: <span style="font-weight: 600;" th:text="${pren.veicoloId.modello}"></span></h4>
                                            <h4>Data: <span style="font-weight: 600;" th:text="${pren.dataPrenotazione}"></span></h4>
                                            <h4>Prezzo: <span style="font-weight: 600;" th:text="${pren.veicoloId.prezzo}"></span>€</h4>
                                             <button class="btn edit editPrenotazione"><i class="fas fa-edit"></i></button>
				                            <form action="/dashboard/removePrenotazione" method="POST">
				                                <input type="hidden" name="utenteId" th:value="${utente.id}">
				                                <input type="hidden" name="prenotazioneId" th:value="${pren.id}">
				                                            <button class="btn delete" >
				                                                <i class="fas fa-trash"></i>
				                                            </button>
				                            </form>
                                            
											<!-- <button class="btn edit editPrenotazione"><i class="fas fa-edit"></i></button>
                           					<button class="btn delete" ><i class="fas fa-trash"></i></button> -->
                                        </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
     
            <!-- UPDATE CLIENTE -->
            <!-- inizio UPD CLIENTE -->
        <div class="container-fluid formAgg" th:switch="${utente}" id="modificaContainerClienti">
            <div th:case="null">ciao</div>
            <div th:case="*" class="container-fluid">
                <button class="btn btn-danger rounded-pill close" id="closeTabCli" ><i class="fas fa-times"></i></button>
                <form class="container" action="/updCliente"  method="post" id="formClienti">
                    <h2>Modifica <span id="questoCliente"></span></h2>
                    <div class="casellaForm">
                        <h3>Username:</h3>
                        <input type="text" class="form-control" name="username" id="username" placeholder="username" required>
                    </div>
                    <div class="casellaForm">
                        <h3>Email:</h3>
                        <input type="email" class="form-control" name="email" id="email" placeholder="email@email.ru" required>
                    </div>
                    <div class="casellaForm">
                        <h3>Nome:</h3>
                        <input type="text" class="form-control" name="nome" id="nome" placeholder="nome" required>
                    </div>
                    <div class="casellaForm">
                        <h3>Cognome:</h3>
                        <input type="text" class="form-control" name="cognome" id="cognome" placeholder="cognome" required>
                    </div>
                    <div class="casellaForm">
                        <h3>Data di nascita:</h3>
                        <input type="date" class="form-control" name="nascita" id="dateBirth" required>
                    </div>
                
                    <div class="col casellaForm" style="padding: 0.5rem 0 0.5rem 0; height: 100%; align-items: center; justify-content: space-around;">
                        <input type="hidden" name="tipo" id="tipo" value="B" th:value="B">
                       <!--  <input type="hidden" name="id" id="idForm" th:value="${utente.id}"> -->
                        <input type="hidden" name="utenteId" th:value="${utente.id}">
                        <button id="btn-ins-cli" class="btn edit" style="width: 100%; height: 100%;"><i class="far fa-thumbs-up"></i> <h4>Inserisci</h4> </button>
                    </div>
                
                </form>
            </div>
        </div>
        <!-- fine upd cliente -->






    </main>
    
    
    <footer class="footer" id="footerContainer"></footer>
</body>

<script src="/js/calendar.js"></script>
<script th:inline="javascript">

    /* manteniamo il login*/
    var utente = [[${utente}]];


    /*verifico la data e aggiorno*/
    var urlData= document.URL;
    var dataURL="";
    console.log(urlData)
    var arrayURL=urlData.split("/");
    console.log(arrayURL)
    if(arrayURL.length>=5){
        var arrayURLperData=arrayURL[4].split("data=");
        dataURL=arrayURLperData[1];
        console.log(dataURL);
        aggiornoCalendarioHTML(dataURL);
        if(arrayURL.length>=6){
            var arrayURLperUtente=arrayURL[5].split("utente=");
            var utenteId=arrayURLperUtente[1];
            console.log(utenteId);
        }
    }

      

    var dataPrenotazione=$("#dataPrenotazione").val();
    console.log(dataPrenotazione);

    if ((dataURL=="")){
        var dataPrenotazione = new Date().toISOString().substring(0, 10);
        $("#dataPrenotazione").val(dataPrenotazione);
        aggiornoDisponibilita();
        
    }


    function aggiornoDisponibilita(){
        /*Prendo input data*/
       var dataPrenotazione= $("#dataPrenotazione").val();
             
        
        //redirect pagina prenotazione con quella data
        //richiedendo al db tutti i veicoli che non hanno una prenotazione in quella data
        if (utente!= null){
            window.location.replace("/booking/data="+dataPrenotazione+"/utente="+utente.id);
        } else{
            window.location.replace("/booking/data="+dataPrenotazione);
        }
       
        
        
        
    }


    /*continua poi su calendar.js*/


    /* grafico emissioni*/
    var ctx = document.getElementById('graficoEmissioni').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [
                'Auto Benzina',
                'Auto Diesel',
                'Auto Ibrida', 
                'Auto Elettrica', 
                'Bici Elettrica', 
                'Bici Human Power', 
                "Monopattino Elettrico" ],
            datasets: [{
                label: 'Emissione risparmiate in g/m3',
                data: [ 0, 0, 40, 60, 95, 100, 95],
                backgroundColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                '#77777',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
                ],
                borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
    scales: {
        y: {
            beginAtZero: true
        }
    }
}
});

/* grafico veicoli */
/*
var veicoliGrafici = [];
for (const veicolo of veicoliGrafici) {
    console.log(veicolo)
}
*/

function checkAlimentazione(ali=""){
switch (ali) {
    case "Human power":
        return 100;
    case "Elettrica":
        return 75;
    case "Ibrida":
        return 66;

    default:
        return 1;
}
}



var graficoVeicoli = document.getElementById('graficoVeicoli').getContext('2d');
var newGraph = new Chart(graficoVeicoli, {
    type: 'radar',
    data: {
        labels: [
        'g/m 3 di CO2 risparmati',
        'prezzo',
        'alimentazione'
        ],
        datasets: [
    [# th:each="veicolo : ${veicoli}"]
    {
      
      label: [[${veicolo.modello}]] ,
      data: [ [[${veicolo.pesoCo2}]]*100, [[${veicolo.prezzo}]], checkAlimentazione([[${veicolo.alimentazione}]])],
      
      
      
      
      
      
      
      fill: true,
      backgroundColor:  [[${veicolo.colore}]]+"4D",
      borderColor: [[${veicolo.colore}]]+"4D",
      pointBackgroundColor: [[${veicolo.colore}]]+"4D",
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: [[${veicolo.colore}]]+"4D",
    },
    
    [/]
        
        ]
    },
    
});


</script>
<!-- aggiungo la navigazione -->
<script src="/js/nav.js"></script>
<script src="/js/home.js"></script>
</html>