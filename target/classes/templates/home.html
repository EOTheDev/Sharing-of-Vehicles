<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- grafico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js" integrity="sha256-yz7K02nILYEeRDwEfzu/1zI9SpBKod/nLYMTFh7vszs=" crossorigin="anonymous"></script>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- css pagina -->
    <link rel="stylesheet" href="/css/home.css">
    <title>Document</title>
    
</head>
<body>
    <!-- carico header con thymeleaf -->
    <header class="header" th:replace="html/nav" id="navbarContainer">
    </header>
    
    <main class="main container-fluid">
        <!-- banner -->
        <div class="row">
            <!-- calendario -->
            <div class="col-lg-4 latoCalendario">
                <div id="calendar" >
                    
                    <div id="topCalendar">
                        <input type="date" onblur="aggiornoDisponibilita()" id="dataPrenotazione">
                    </div>
                    <div id="dateCalendar">
                        <!-- <button class="btn btn-primary"><i class="fas fa-arrow-left"></i></button> -->
                        <span id="giorno">
                            23
                        </span>
        
                        <!-- <button class="btn btn-primary"><i class="fas fa-arrow-right"></i></button> -->
                    </div>
                    <span id="mese">Aprile</span><br>
                    <span id="anno">2021</span>
                </div>
                <i class="fas fa-leaf" style="font-size: 4rem; color:#9dc119;padding: 1rem 0;"></i>
                <a th:switch="${utente}" style="padding: 1rem 0;" href="/login">
                    <button th:case="null" class="btn btn-primary" id="loginBtn">Fai il login per noleggiare!</button>
                    <button th:case="*" class="btn btn-primary" id="loginBtn">Grazie, [[${utente.nome}]], per inquinare meno!</button>
                </a>
            </div>
            <!-- fine calendario -->
            <!-- inizio veicoli -->
            <div class="col-lg-8 elencoVeicoli">
                <h1>I veicoli disponibili</h1>
                <!-- singolo veicolo -->
                <div id="veicoliDisponibili" th:each="veicolo:${veicoli}">
                    <div class="row singoloVeicolo">
                        <div th:switch="${utente}"class="col-lg-2 side">
                            <img class="col-lg-12" src="https://www.you-go.it/wp-content/uploads/2020/11/volkswagen-id3-bianca-647x277.png" th:attr="src=@{${veicolo.immagine}}"alt="" >
                            <a th:case="null" class="col-lg-12" href="/veicolo" th:href="@{'/veicolo/'+${veicolo.id}}"><button class="col-12 btn edit">Iscriviti</button></a> 
                            <a th:case="*" class="col-lg-12" href="/veicolo" th:href="@{'/veicolo/'+${veicolo.id}+'/'+${utente.id}}"><button class="col-12 btn edit">Prenota</button></a> 
                            
                        </div>
                        <div class="col-lg-10 rightSide">
                            <h2 th:switch="${veicolo.alimentazione}" class="titolo">
                                <span class="modello" th:text="${veicolo.modello}">BMW I8</span>
                                <i th:case="'Diesel'" class="fas fa-smog text-muted">
                                    <span class="text-muted alimentazione" th:text="${veicolo.alimentazione}"> 
                                        Ibrida
                                    </span> <!-- se implemento thymeleaf sovrascrive icona -->
                                </i>
                                <i th:case="'benzina'" class="fas fa-smog text-muted">
                                    <span class="text-muted alimentazione" th:text="${veicolo.alimentazione}"> 
                                        Ibrida
                                    </span> <!-- se implemento thymeleaf sovrascrive icona -->
                                </i>
                                <i th:case="*" class="fas fa-bolt text-muted">
                                    <span class="text-muted alimentazione" th:text="${veicolo.alimentazione}"> 
                                        Ibrida
                                    </span> <!-- se implemento thymeleaf sovrascrive icona -->
                                </i>
                            </h2>
                            <div th:switch="${veicolo.tipologia}" class="text">
                                <!-- if auto fa-car-alt, else if fa-leaf -->                              
                                <i th:case="'auto'" class="fas fa-car-alt">
                                    <span class="tipo" th:text="${veicolo.tipologia}"> Auto</span>
                                </i>
                                <i th:case="*" class="fas fa-leaf ">
                                    <span class="tipo" th:text="${veicolo.tipologia}"> Auto</span>
                                </i>
                                
                                <i class="fas fa-map-marker-alt">
                                    <span class="posizione" th:text="${veicolo.indirizzo}"> Via del Campo, Torino </span>
                                </i>
                                <div class="descrizione" th:text="${veicolo.descrizione}">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum iusto excepturi deserunt, error optio laboriosam expedita laudantium repellat. Impedit, laboriosam aliquid quibusdam deleniti dolores eaque ratione tenetur harum porro quis!*5</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <!-- fine singolo veicolo -->

            </div>
        </div>
        <!-- fine banner veicoli -->
        <!-- inizio grafico -->
        <div class="container">
            <!-- grafico 1 -->
            <div class="row graphicMaster">
                <div class="col-lg-6 sinistraGrafico">
                    <h2 id="titoloGrafico">
                        Emissioni risparmiate
                    </h2>
                    <h4 class="text-muted" id="sottotitoloGrafico">
                        Calcolo delle emissioni risparmiate per ogni nostro tipo di veicolo 
                    </h4>
                    <p>
                        Per il rispetto dell'ambiente e per la lotta al cambiamento climatico è bene avere in mente delle informazioni chiare sull'impatto ambientale delle nostre scelte.
                        <br>E' noto che:
                        <ul> 
                        <li>Un'auto diesel produce 2380g di Co2 per ogni litro consumato.</li>
                        <li>Un'auto ibrida produce 60g di Co2 per ogni km percorso.</li>
                        <li>Un'auto benzina produce 1610g di Co2 per ogni litro di benzina consumato.</li>
                        <li>Un'auto elettrica non produce Co2 per consumo diretto ma soltanto nella sua creazione.</li>
                        </ul>
                        Come mostrato nel grafico, possiamo notare le emissioni risparmiate con l'utilizzo di un veicolo ibrido o elttrico.</p>
                    
                </div>
                
                <div class="col-lg-4">
                    <canvas id="graficoEmissioni"  width="400" height="400"></canvas>
                </div>
                <div class="col"></div>
                
            </div>
            <!-- fine grafico 1 -->
            <div class="row graphicMaster">
                <div class="col"></div>
                <div class="col-lg-4">
                    <canvas id="graficoVeicoli"  width="400" height="400"></canvas>
                    
                </div>
                <div class="col-lg-6 sinistraGrafico">
                    <h2 id="titoloGrafico">
                        I nostri veicoli
                    </h2>
                    <h4 class="text-muted" id="sottotitoloGrafico">
                        Grafico che compara i nostri veicoli per prezzo, emissioni risparmiate, tipologia ed alimentazione
                    </h4>
                    <p>
                        <p>Come si può notare nel grafico, la scelta green è sempre la migliore soluzione, verso la quale cerchiamo di indirizzare i nostri clienti, consigliando un'alimentazione ecosostenibile.</p>
                        <p>Comparando le nostre tipologie di veicoli, anche per fascia di prezzo, possiamo vedere che oltre a veicoli con poche emissioni ma a prezzi elevati, disponiamo inoltre di prodotti più economici, ma allo stesso tempo eco-friendly, come ad esempio la bicicletta "Kinky Segway 500", o le stampelle "Power 2000".</p>
                    </p>
                    
                </div>
            </div>
        </div>
        
    </main>
    
    <footer class="footer" id="footerContainer"></footer>
</body>
<!-- JQUERY NECESSARIO PER NAV -->
<script src="https://code.jquery.com/jquery-3.6.0.js"        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

<script th:inline="javascript">

    /* manteniamo il login*/
    var utente = [[${utente}]];



    /*verifico la data e aggiorno*/



    // metodo malvagio che rompe tutto ricorsivamente
    var urlData= document.URL;
    var dataURL="";
    console.log(urlData)
    var arrayURL=urlData.split("/");
    console.log(arrayURL)
    if(arrayURL.length>=5){
        var arrayURLperData=arrayURL[4].split("data=");
        dataURL=arrayURLperData[1];
        console.log(dataURL);
        aggiornoCalendarioHTML(dataURL);
        if(arrayURL.length>=6){
            var arrayURLperUtente=arrayURL[5].split("utente=");
            var utenteId=arrayURLperUtente[1];
            console.log(utenteId);
        }
    }
    var dataPrenotazione=$("#dataPrenotazione").val();
    console.log(dataPrenotazione);

    if ((dataURL=="")){
        var dataPrenotazione = new Date().toISOString().substring(0, 10);
        $("#dataPrenotazione").val(dataPrenotazione);
        //if (dataPrenotazione!=today){
            console.log("sono qui")
        //  console.log(dataPrenotazione!=today)
            //aggiornoCalendarioHTML();
            aggiornoDisponibilita();
        //}
    }


    /*Prendo input data*/
    function aggiornoDisponibilita(){
       var dataPrenotazione= $("#dataPrenotazione").val();
             
        
        //redirect pagina prenotazione con quella data
        //richiedendo al db tutti i veicoli che non hanno una prenotazione in quella data
        if (utente!= null){
            window.location.replace("/booking/data="+dataPrenotazione+"/utente="+utente.id);
        } else{
            window.location.replace("/booking/data="+dataPrenotazione);
        }
       
        
        
        
    }
    
    
    
    
    /*aggiorno il calendario*/
    function aggiornoCalendarioHTML(dataPrenotazione){
        var data= new Date(dataPrenotazione);
        $("#dataPrenotazione").val(data.toISOString().substring(0, 10));



        dataPrenotazione=dataPrenotazione.split("-");
        //console.log(dataPrenotazione);
        $("#giorno").text(dataPrenotazione[2]);
        switch (dataPrenotazione[1]){
            case "01":
            $("#mese").text("Gennaio");
            break;
            case "02":
            $("#mese").text("Febbraio");
            break;
            case "03":
            $("#mese").text("Marzo");
            break;
            case "04":
            $("#mese").text("Aprile");
            break;
            case "05":
            $("#mese").text("Maggio");
            break;
            case "06":
            $("#mese").text("Giugno");
            break;
            case "07":
            $("#mese").text("Luglio");
            break;
            case "08":
            $("#mese").text("Agosto");
            break;
            case "09":
            $("#mese").text("Settembre");
            break;
            case "10":
            $("#mese").text("Ottobre");
            break;
            case "11":
            $("#mese").text("Novembre");
            break;
            case "12":
            $("#mese").text("Dicembre");
            break;
            default:
            $("#mese").text("Errore");
            break;
        }
        
        $("#anno").text(dataPrenotazione[0]);
    }
    /*fine funzione calendario*/


    /* grafico emissioni*/
    var ctx = document.getElementById('graficoEmissioni').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [
                'Auto Benzina',
                'Auto Diesel',
                'Auto Ibrida', 
                'Auto Elettrica', 
                'Bici Elettrica', 
                'Bici Human Power', 
                "Monopattino Elettrico" ],
            datasets: [{
                label: 'Emissione risparmiate in g/m3',
                data: [ 0, 0, 40, 60, 95, 100, 95],
                backgroundColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                '#77777',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
                ],
                borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
    scales: {
        y: {
            beginAtZero: true
        }
    }
}
});

/* grafico veicoli */
/*
var veicoliGrafici = [];
for (const veicolo of veicoliGrafici) {
    console.log(veicolo)
}
*/

function checkAlimentazione(ali=""){
switch (ali) {
    case "human power":
        return 100;
    case "elettrica":
        return 75;
    case "ibrida":
        return 66;

    default:
        return 1;
}
}



var graficoVeicoli = document.getElementById('graficoVeicoli').getContext('2d');
var newGraph = new Chart(graficoVeicoli, {
    type: 'radar',
    data: {
        labels: [
        'g/m 3 di CO2 risparmati',
        'prezzo',
        'alimentazione',
        ],
        datasets: [
    [# th:each="veicolo : ${veicoli}"]
    {
      
      label: [[${veicolo.modello}]] ,
      data: [ [[${veicolo.pesoCo2}]]*100, [[${veicolo.prezzo}]], checkAlimentazione([[${veicolo.alimentazione}]])],
      
      
      
      
      
      
      
      fill: true,
      backgroundColor:  [[${veicolo.colore}]]+"4D",
      borderColor: [[${veicolo.colore}]]+"4D",
      pointBackgroundColor: [[${veicolo.colore}]]+"4D",
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: [[${veicolo.colore}]]+"4D",
    },
    
    [/]
        
        ]
    },
    
});


</script>
<!-- aggiungo la navigazione -->
<script src="/js/nav.js"></script>
</html>